\hypertarget{pwm_8c}{}\section{src/pwm.c File Reference}
\label{pwm_8c}\index{src/pwm.\+c@{src/pwm.\+c}}


The file that controls the real and fake pwm controllers.  


{\ttfamily \#include $<$neo.\+h$>$}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structparams}{params}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
\hypertarget{pwm_8c_a228631ba4c3f880f9e6f13b43caad473}{}\label{pwm_8c_a228631ba4c3f880f9e6f13b43caad473} 
typedef struct \hyperlink{structparams}{params} {\bfseries params\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{pwm_8c_ac3ad9f77af407aee3e35a2fc2413d19d}{neo\+\_\+pwm\+\_\+init} ()
\begin{DoxyCompactList}\small\item\em Initializes the R\+E\+AL pwm pins on the Udoo. \end{DoxyCompactList}\item 
int \hyperlink{pwm_8c_a3eb536e6ed5e5019b0cd57b98b1059d3}{neo\+\_\+fake\+\_\+pwm\+\_\+init} ()
\begin{DoxyCompactList}\small\item\em Initializes the F\+A\+KE pwm, p.\+s this is the same as neo\+\_\+gpio\+\_\+init. \end{DoxyCompactList}\item 
int \hyperlink{pwm_8c_a8af233ae9556ba1b3c26589d526e9fa6}{neo\+\_\+fake\+\_\+pwm\+\_\+write\+\_\+period} (int gpio\+Pin, int period, int duty)
\begin{DoxyCompactList}\small\item\em Main write method for fake\+\_\+pwm. \end{DoxyCompactList}\item 
int \hyperlink{pwm_8c_a3481999a8f3514ddd7b8f357bf7234db}{neo\+\_\+fake\+\_\+pwm\+\_\+write} (int gpio\+Pin, int duty)
\begin{DoxyCompactList}\small\item\em Duty write method for fake\+\_\+pwm. \end{DoxyCompactList}\item 
int \hyperlink{pwm_8c_adc47be04e8829bade2f04edd1b4e2cff}{neo\+\_\+pwm\+\_\+write} (int pin, int duty)
\begin{DoxyCompactList}\small\item\em Main write method for real pwm. \end{DoxyCompactList}\item 
int \hyperlink{pwm_8c_a190f359fa2bac2199ffdc9e81ad674fc}{neo\+\_\+pwm\+\_\+set\+\_\+period\+\_\+all} (int period)
\begin{DoxyCompactList}\small\item\em Sets period for all real pwm pins. \end{DoxyCompactList}\item 
int \hyperlink{pwm_8c_a9ba92fd09e504256ce44d63db9413694}{neo\+\_\+pwm\+\_\+set\+\_\+period} (int pin, int period)
\begin{DoxyCompactList}\small\item\em Sets period for a single pwm pin. \end{DoxyCompactList}\item 
int \hyperlink{pwm_8c_a03628a77f1f0324fb0d7aff595be98ba}{neo\+\_\+pwm\+\_\+free} ()
\begin{DoxyCompactList}\small\item\em Main function to release the real pwm. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
The file that controls the real and fake pwm controllers. 

\begin{DoxyAuthor}{Author}
David Smerkous 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
11/28/2016 This source file is the core of the F\+A\+KE P\+WM M\+A\+N\+A\+G\+ER which controls A threaded pwm manager on A\+NY gpio pin available on the board as well as A real P\+WM access to the available pwm pins.
\end{DoxyDate}
\begin{DoxyNote}{Note}
Please use device tree editor to view what pwm pins are available 
\end{DoxyNote}


\subsection{Function Documentation}
\hypertarget{pwm_8c_a3eb536e6ed5e5019b0cd57b98b1059d3}{}\label{pwm_8c_a3eb536e6ed5e5019b0cd57b98b1059d3} 
\index{pwm.\+c@{pwm.\+c}!neo\+\_\+fake\+\_\+pwm\+\_\+init@{neo\+\_\+fake\+\_\+pwm\+\_\+init}}
\index{neo\+\_\+fake\+\_\+pwm\+\_\+init@{neo\+\_\+fake\+\_\+pwm\+\_\+init}!pwm.\+c@{pwm.\+c}}
\subsubsection{\texorpdfstring{neo\+\_\+fake\+\_\+pwm\+\_\+init()}{neo\_fake\_pwm\_init()}}
{\ttfamily int neo\+\_\+fake\+\_\+pwm\+\_\+init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Initializes the F\+A\+KE pwm, p.\+s this is the same as neo\+\_\+gpio\+\_\+init. 

Initializes the gpio pins for the pwm manager, there is no worry calling this twice It\textquotesingle{}s just unnecessary if you\textquotesingle{}re using neo\+\_\+gpio\+\_\+init before this method

\begin{DoxyReturn}{Returns}
Look at neo\+\_\+gpio\+\_\+init for return types. N\+E\+O\+\_\+\+OK when successful 
\end{DoxyReturn}
\hypertarget{pwm_8c_a3481999a8f3514ddd7b8f357bf7234db}{}\label{pwm_8c_a3481999a8f3514ddd7b8f357bf7234db} 
\index{pwm.\+c@{pwm.\+c}!neo\+\_\+fake\+\_\+pwm\+\_\+write@{neo\+\_\+fake\+\_\+pwm\+\_\+write}}
\index{neo\+\_\+fake\+\_\+pwm\+\_\+write@{neo\+\_\+fake\+\_\+pwm\+\_\+write}!pwm.\+c@{pwm.\+c}}
\subsubsection{\texorpdfstring{neo\+\_\+fake\+\_\+pwm\+\_\+write()}{neo\_fake\_pwm\_write()}}
{\ttfamily int neo\+\_\+fake\+\_\+pwm\+\_\+write (\begin{DoxyParamCaption}\item[{int}]{gpio\+Pin,  }\item[{int}]{duty }\end{DoxyParamCaption})}



Duty write method for fake\+\_\+pwm. 

This will just write the update duty cycle for the pwm\+\_\+pin, this will not update the period Unless the global variable is also updated, please make sure that all pins work on same frequency For simplicity reasons. \begin{DoxySeeAlso}{See also}
\hyperlink{pwm_8c_a8af233ae9556ba1b3c26589d526e9fa6}{neo\+\_\+fake\+\_\+pwm\+\_\+write\+\_\+period} to update the period
\end{DoxySeeAlso}

\begin{DoxyParams}{Parameters}
{\em gpio\+Pin} & The gpio bank pin to set or update the fake pwm manager on \\
\hline
{\em duty} & The duty cycle percentage between 0 and 255 (Like arduino)\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+E\+O\+\_\+\+O\+K/\+N\+E\+O\+\_\+\+D\+U\+T\+Y\+\_\+\+E\+R\+R\+OR or N\+E\+O\+\_\+\+P\+I\+N\+\_\+\+E\+R\+R\+OR if the params are wrong 
\end{DoxyReturn}
\hypertarget{pwm_8c_a8af233ae9556ba1b3c26589d526e9fa6}{}\label{pwm_8c_a8af233ae9556ba1b3c26589d526e9fa6} 
\index{pwm.\+c@{pwm.\+c}!neo\+\_\+fake\+\_\+pwm\+\_\+write\+\_\+period@{neo\+\_\+fake\+\_\+pwm\+\_\+write\+\_\+period}}
\index{neo\+\_\+fake\+\_\+pwm\+\_\+write\+\_\+period@{neo\+\_\+fake\+\_\+pwm\+\_\+write\+\_\+period}!pwm.\+c@{pwm.\+c}}
\subsubsection{\texorpdfstring{neo\+\_\+fake\+\_\+pwm\+\_\+write\+\_\+period()}{neo\_fake\_pwm\_write\_period()}}
{\ttfamily int neo\+\_\+fake\+\_\+pwm\+\_\+write\+\_\+period (\begin{DoxyParamCaption}\item[{int}]{gpio\+Pin,  }\item[{int}]{period,  }\item[{int}]{duty }\end{DoxyParamCaption})}



Main write method for fake\+\_\+pwm. 

Thise will create a new F\+A\+K\+E\+P\+W\+M\+M\+A\+N\+A\+G\+ER thread on the selected bank G\+P\+IO pin The manager will only be created if there isn\textquotesingle{}t one already on that pin. So don\textquotesingle{}t worry about Calling this method multiple times. Actually do it when you want to update the duty cycle. \begin{DoxySeeAlso}{See also}
\hyperlink{pwm_8c_a3481999a8f3514ddd7b8f357bf7234db}{neo\+\_\+fake\+\_\+pwm\+\_\+write} If you want to see the regular duty cycle update. The second argument is period.
\end{DoxySeeAlso}

\begin{DoxyParams}{Parameters}
{\em gpio\+Pin} & The gpio bank pin to set or update the fake pwm manager on \\
\hline
{\em period} & The nano second update time for the period \\
\hline
{\em duty} & The duty cycle percentage between 0 and 255 (Like arduino)\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+E\+O\+\_\+\+O\+K/\+N\+E\+O\+\_\+\+D\+U\+T\+Y\+\_\+\+E\+R\+R\+OR or N\+E\+O\+\_\+\+P\+I\+N\+\_\+\+E\+R\+R\+OR if the params are wrong
\end{DoxyReturn}
\begin{DoxyNote}{Note}
The period argument is in nano second update time for period so 1000000000 would be 1\+Hz (Aka 1 loop per second) 
\end{DoxyNote}
\hypertarget{pwm_8c_a03628a77f1f0324fb0d7aff595be98ba}{}\label{pwm_8c_a03628a77f1f0324fb0d7aff595be98ba} 
\index{pwm.\+c@{pwm.\+c}!neo\+\_\+pwm\+\_\+free@{neo\+\_\+pwm\+\_\+free}}
\index{neo\+\_\+pwm\+\_\+free@{neo\+\_\+pwm\+\_\+free}!pwm.\+c@{pwm.\+c}}
\subsubsection{\texorpdfstring{neo\+\_\+pwm\+\_\+free()}{neo\_pwm\_free()}}
{\ttfamily int neo\+\_\+pwm\+\_\+free (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Main function to release the real pwm. 

This is the exact opposite of neo\+\_\+pwm\+\_\+init where you deinitialize the pins Freeing up the pins for another process to use

\begin{DoxyReturn}{Returns}
N\+E\+O\+\_\+\+OK or N\+E\+O\+\_\+\+U\+N\+U\+S\+A\+B\+L\+E\+\_\+\+E\+R\+R\+OR if the params are wrong 
\end{DoxyReturn}
\hypertarget{pwm_8c_ac3ad9f77af407aee3e35a2fc2413d19d}{}\label{pwm_8c_ac3ad9f77af407aee3e35a2fc2413d19d} 
\index{pwm.\+c@{pwm.\+c}!neo\+\_\+pwm\+\_\+init@{neo\+\_\+pwm\+\_\+init}}
\index{neo\+\_\+pwm\+\_\+init@{neo\+\_\+pwm\+\_\+init}!pwm.\+c@{pwm.\+c}}
\subsubsection{\texorpdfstring{neo\+\_\+pwm\+\_\+init()}{neo\_pwm\_init()}}
{\ttfamily int neo\+\_\+pwm\+\_\+init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Initializes the R\+E\+AL pwm pins on the Udoo. 

Starts the internal P\+WM controllers. This is recommended over F\+A\+K\+E\+P\+WM since It is actually pwm that has a real controller. Although this is not recommended Since it can conflict with the G\+P\+IO pin that\textquotesingle{}s also being used

\begin{DoxyReturn}{Returns}
N\+E\+O\+\_\+\+OK or N\+E\+O\+\_\+\+E\+X\+P\+O\+R\+T\+\_\+\+E\+R\+R\+OR if some P\+WM weren\textquotesingle{}t initialized
\end{DoxyReturn}
\begin{DoxyNote}{Note}
Do not use the same G\+P\+IO as output or input! It will override this 

N\+E\+O\+\_\+\+U\+N\+U\+S\+A\+B\+L\+E\+\_\+\+E\+R\+R\+OR might be returned if that pin doesn\textquotesingle{}t support P\+WM or it\textquotesingle{}s not mapped using device tree editor 
\end{DoxyNote}
\hypertarget{pwm_8c_a9ba92fd09e504256ce44d63db9413694}{}\label{pwm_8c_a9ba92fd09e504256ce44d63db9413694} 
\index{pwm.\+c@{pwm.\+c}!neo\+\_\+pwm\+\_\+set\+\_\+period@{neo\+\_\+pwm\+\_\+set\+\_\+period}}
\index{neo\+\_\+pwm\+\_\+set\+\_\+period@{neo\+\_\+pwm\+\_\+set\+\_\+period}!pwm.\+c@{pwm.\+c}}
\subsubsection{\texorpdfstring{neo\+\_\+pwm\+\_\+set\+\_\+period()}{neo\_pwm\_set\_period()}}
{\ttfamily int neo\+\_\+pwm\+\_\+set\+\_\+period (\begin{DoxyParamCaption}\item[{int}]{pin,  }\item[{int}]{period }\end{DoxyParamCaption})}



Sets period for a single pwm pin. 


\begin{DoxyParams}{Parameters}
{\em pin} & The pwm pin to set the current \\
\hline
{\em period} & The nanosecond update period per loop period\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+E\+O\+\_\+\+O\+K/\+N\+E\+O\+\_\+\+P\+E\+R\+I\+O\+D\+\_\+\+E\+R\+R\+O\+R/\+N\+E\+O\+\_\+\+P\+I\+N\+\_\+\+E\+R\+R\+OR or N\+E\+O\+\_\+\+U\+N\+U\+S\+A\+B\+L\+E\+\_\+\+E\+R\+R\+OR if the params are wrong 
\end{DoxyReturn}
\begin{DoxyNote}{Note}
The period argument is in nano second update time for period so 1000000000 would be 1\+Hz (Aka 1 loop per second) 
\end{DoxyNote}
\hypertarget{pwm_8c_a190f359fa2bac2199ffdc9e81ad674fc}{}\label{pwm_8c_a190f359fa2bac2199ffdc9e81ad674fc} 
\index{pwm.\+c@{pwm.\+c}!neo\+\_\+pwm\+\_\+set\+\_\+period\+\_\+all@{neo\+\_\+pwm\+\_\+set\+\_\+period\+\_\+all}}
\index{neo\+\_\+pwm\+\_\+set\+\_\+period\+\_\+all@{neo\+\_\+pwm\+\_\+set\+\_\+period\+\_\+all}!pwm.\+c@{pwm.\+c}}
\subsubsection{\texorpdfstring{neo\+\_\+pwm\+\_\+set\+\_\+period\+\_\+all()}{neo\_pwm\_set\_period\_all()}}
{\ttfamily int neo\+\_\+pwm\+\_\+set\+\_\+period\+\_\+all (\begin{DoxyParamCaption}\item[{int}]{period }\end{DoxyParamCaption})}



Sets period for all real pwm pins. 

Updates the period for all the real pwm pins in one function of course you could do it manually With a for loop. This is just for those lazy people who don\textquotesingle{}t want to do that


\begin{DoxyParams}{Parameters}
{\em period} & The nanosecond update period per loop period\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+E\+O\+\_\+\+O\+K/\+N\+E\+O\+\_\+\+P\+E\+R\+I\+O\+D\+\_\+\+E\+R\+R\+O\+R/\+N\+E\+O\+\_\+\+P\+I\+N\+\_\+\+E\+R\+R\+OR or N\+E\+O\+\_\+\+U\+N\+U\+S\+A\+B\+L\+E\+\_\+\+E\+R\+R\+OR if the params are wrong 
\end{DoxyReturn}
\begin{DoxyNote}{Note}
The period argument is in nano second update time for period so 1000000000 would be 1\+Hz (Aka 1 loop per second) 
\end{DoxyNote}
\hypertarget{pwm_8c_adc47be04e8829bade2f04edd1b4e2cff}{}\label{pwm_8c_adc47be04e8829bade2f04edd1b4e2cff} 
\index{pwm.\+c@{pwm.\+c}!neo\+\_\+pwm\+\_\+write@{neo\+\_\+pwm\+\_\+write}}
\index{neo\+\_\+pwm\+\_\+write@{neo\+\_\+pwm\+\_\+write}!pwm.\+c@{pwm.\+c}}
\subsubsection{\texorpdfstring{neo\+\_\+pwm\+\_\+write()}{neo\_pwm\_write()}}
{\ttfamily int neo\+\_\+pwm\+\_\+write (\begin{DoxyParamCaption}\item[{int}]{pin,  }\item[{int}]{duty }\end{DoxyParamCaption})}



Main write method for real pwm. 

For the real pwm you don\textquotesingle{}t set the period within the write method but rather than You will just set the duty between 0 (min) and 255 (max)


\begin{DoxyParams}{Parameters}
{\em pin} & The gpio bank pin to set or update the fake pwm manager on \\
\hline
{\em duty} & The duty cycle percentage between 0 and 255 (Like arduino)\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
N\+E\+O\+\_\+\+O\+K/\+N\+E\+O\+\_\+\+D\+U\+T\+Y\+\_\+\+E\+R\+R\+O\+R/\+N\+E\+O\+\_\+\+P\+I\+N\+\_\+\+E\+R\+R\+OR or N\+E\+O\+\_\+\+U\+N\+U\+S\+A\+B\+L\+E\+\_\+\+E\+R\+R\+OR if the params are wrong 
\end{DoxyReturn}
\begin{DoxyNote}{Note}
N\+E\+O\+\_\+\+U\+N\+U\+S\+A\+B\+L\+E\+\_\+\+E\+R\+R\+OR might be returned if that pin doesn\textquotesingle{}t support P\+WM or it\textquotesingle{}s not mapped using device tree editor 
\end{DoxyNote}
